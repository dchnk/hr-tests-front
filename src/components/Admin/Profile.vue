<script setup>
import {ref} from "vue";
import {useUserStore} from "../../stores/user.js";
import axios from "axios";

const isOpen = ref(false);
const userStore = useUserStore();

function handleOpenMenu() {
  isOpen.value = !isOpen.value;
}

const logout = async () => {
  try {
    const logoutResult = await axios.post("/api/logout");

    console.log(logoutResult)
    window.location.reload();
  } catch (e) {
    console.log(e);
  }

}

</script>

<template>
  <div class="profile" @click="handleOpenMenu">
    <div class="name">{{ userStore.user?.name }}</div>
    <div class="img"/>
    <div class="arrow" :class="isOpen && 'open'"/>

    <div class="content" :class="isOpen && 'open'">
      <div class="item" v-if="false">
        <svg class="icon profile" xmlns="http://www.w3.org/2000/svg" width="14" height="18" viewBox="0 0 14 18"
             fill="none">
          <path
              d="M6.73338 2.4001C5.38949 2.4001 4.30005 3.48954 4.30005 4.83343C4.30005 6.17732 5.38949 7.26676 6.73338 7.26676C8.07727 7.26676 9.16671 6.17732 9.16671 4.83343C9.16671 3.48954 8.07727 2.4001 6.73338 2.4001ZM2.50005 4.83343C2.50005 2.49543 4.39537 0.600098 6.73338 0.600098C9.07138 0.600098 10.9667 2.49543 10.9667 4.83343C10.9667 7.17144 9.07138 9.06676 6.73338 9.06676C4.39537 9.06676 2.50005 7.17144 2.50005 4.83343ZM3.50286 11.5665C3.4565 11.563 3.43046 11.5633 3.23157 11.5785C3.17894 11.5825 3.1427 11.5873 3.11502 11.5924C2.4584 11.7112 1.94451 12.2251 1.82564 12.8817C1.80367 13.0031 1.80004 13.1679 1.80004 13.7368V15.1668C1.80004 15.377 1.80055 15.5039 1.80536 15.5948C1.89627 15.5996 2.02315 15.6001 2.23338 15.6001H11.2334C11.4436 15.6001 11.5705 15.5996 11.6614 15.5948C11.6662 15.5039 11.6667 15.377 11.6667 15.1668V13.7324C11.6667 13.1679 11.6631 13.0043 11.6415 12.884C11.5233 12.2255 11.0079 11.7102 10.3495 11.592C10.3229 11.5872 10.2873 11.5824 10.2353 11.5785C10.0362 11.5633 10.0101 11.563 9.96378 11.5665C9.91579 11.5701 9.89737 11.5728 9.88731 11.5746C9.87725 11.5764 9.85899 11.5801 9.81266 11.5932C9.81317 11.593 9.81382 11.5928 9.81266 11.5932C9.80559 11.5957 9.76369 11.6105 9.65634 11.6569C9.54132 11.7066 9.38658 11.7767 9.16574 11.8767C8.42296 12.2132 7.59878 12.4001 6.73338 12.4001C5.86798 12.4001 5.0438 12.2132 4.30102 11.8767C4.08015 11.7767 3.9254 11.7066 3.81037 11.6569C3.70296 11.6105 3.66197 11.596 3.65492 11.5935C3.65377 11.5931 3.65441 11.5933 3.65492 11.5935C3.60864 11.5804 3.58946 11.5764 3.57936 11.5746C3.56927 11.5728 3.55081 11.57 3.50286 11.5665ZM3.12101 9.78166C3.28715 9.76892 3.44262 9.75699 3.63658 9.77144C3.82681 9.78561 3.95908 9.80895 4.14268 9.86074C4.33162 9.91403 4.60588 10.0385 4.95104 10.1951C4.9814 10.2088 5.01231 10.2229 5.04377 10.2371C5.55783 10.47 6.1292 10.6001 6.73338 10.6001C7.33756 10.6001 7.90892 10.47 8.42299 10.2371C8.45445 10.2229 8.48537 10.2088 8.51574 10.1951C8.86085 10.0385 9.13505 9.91407 9.32392 9.86079C9.50749 9.809 9.63962 9.78567 9.82984 9.77148C10.0237 9.75701 10.1793 9.76891 10.3455 9.78163C10.3542 9.7823 10.363 9.78297 10.3718 9.78364C10.4709 9.79117 10.5687 9.80251 10.6677 9.8203C12.0668 10.0716 13.1619 11.1667 13.4132 12.5658C13.4671 12.8659 13.4669 13.2051 13.4667 13.6512C13.4667 13.6779 13.4667 13.7049 13.4667 13.7324L13.4667 15.1947C13.4667 15.4038 13.4668 15.6111 13.4524 15.7874C13.4365 15.982 13.3986 16.2165 13.2778 16.4537C13.1116 16.7798 12.8464 17.045 12.5203 17.2112C12.2831 17.332 12.0486 17.3699 11.854 17.3858C11.6777 17.4002 11.4704 17.4001 11.2613 17.4001H2.20547C1.99637 17.4001 1.78903 17.4002 1.61276 17.3858C1.41814 17.3699 1.18361 17.332 0.946461 17.2112C0.620315 17.045 0.355148 16.7798 0.188967 16.4537C0.0681322 16.2165 0.0302881 15.982 0.0143873 15.7874C-1.45221e-05 15.6111 1.379e-05 15.4038 4.23406e-05 15.1947L4.4844e-05 13.7368C4.4844e-05 13.7092 3.33403e-05 13.6819 2.19559e-05 13.6551C-0.000168362 13.2054 -0.00031314 12.8635 0.0544275 12.5611C0.307029 11.1658 1.39906 10.0737 2.79437 9.82115C2.89488 9.80295 2.99398 9.79135 3.09478 9.78367C3.10356 9.783 3.1123 9.78233 3.12101 9.78166Z"
          />
        </svg>
        <div class="text">Профиль</div>
      </div>
      <div class="item">
        <svg class="icon wallet" width="20" height="18" viewBox="0 0 20 18" fill="none"
             xmlns="http://www.w3.org/2000/svg">
          <path
              d="M16 5V4.2C16 3.0799 16 2.51984 15.782 2.09202C15.5903 1.71569 15.2843 1.40973 14.908 1.21799C14.4802 1 13.9201 1 12.8 1H4.2C3.07989 1 2.51984 1 2.09202 1.21799C1.71569 1.40973 1.40973 1.71569 1.21799 2.09202C1 2.51984 1 3.0799 1 4.2V5M19 9H17C15.8954 9 15 9.89543 15 11C15 12.1046 15.8954 13 17 13H19M1 5V13.8C1 14.9201 1 15.4802 1.21799 15.908C1.40973 16.2843 1.71569 16.5903 2.09202 16.782C2.51984 17 3.07989 17 4.2 17H15.8C16.9201 17 17.4802 17 17.908 16.782C18.2843 16.5903 18.5903 16.2843 18.782 15.908C19 15.4802 19 14.9201 19 13.8V8.2C19 7.0799 19 6.51984 18.782 6.09202C18.5903 5.71569 18.2843 5.40973 17.908 5.21799C17.4802 5 16.9201 5 15.8 5H1Z"
              stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div class="text">Баланс и платежи</div>
      </div>
      <div class="item">
        <svg class="icon help" width="18" height="18" viewBox="0 0 18 18" fill="none"
             xmlns="http://www.w3.org/2000/svg">
          <path
              d="M15.1669 14C15.4864 13.3749 15.6667 12.6669 15.6667 11.9167C15.6667 9.38536 13.6146 7.33333 11.0833 7.33333C8.55203 7.33333 6.5 9.38536 6.5 11.9167C6.5 14.448 8.55203 16.5 11.0833 16.5L16.5 16.5C16.5 16.5 15.6667 15.6667 15.1786 14.0243M14.7083 9C14.7903 8.59611 14.8333 8.17808 14.8333 7.75C14.8333 4.29822 12.0351 1.5 8.58333 1.5C5.13155 1.5 2.33333 4.29822 2.33333 7.75C2.33333 8.48049 2.45865 9.18171 2.68897 9.83333C3.58415 12.3431 1.5 14 1.5 14H6.91667"
              stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div class="text">Техподдержка</div>
      </div>
      <div class="item" @click="logout">
        <svg class="icon exit" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
          <path
              d="M14.6001 0.999951H9.80005C9.58787 0.999951 9.38438 1.08424 9.23435 1.23427C9.08432 1.3843 9.00003 1.58779 9.00003 1.79997C9.00003 2.01214 9.08432 2.21563 9.23435 2.36566C9.38438 2.5157 9.58787 2.59998 9.80005 2.59998H14.6001C14.8123 2.59998 15.0158 2.68427 15.1658 2.8343C15.3159 2.98434 15.4002 3.18782 15.4002 3.4V14.6002C15.4002 14.8124 15.3159 15.0159 15.1658 15.1659C15.0158 15.316 14.8123 15.4002 14.6001 15.4002H9.80005C9.58787 15.4002 9.38438 15.4845 9.23435 15.6346C9.08432 15.7846 9.00003 15.9881 9.00003 16.2003C9.00003 16.4124 9.08432 16.6159 9.23435 16.766C9.38438 16.916 9.58787 17.0003 9.80005 17.0003H14.6001C15.2367 17.0003 15.8471 16.7474 16.2972 16.2973C16.7473 15.8472 17.0002 15.2368 17.0002 14.6002V3.4C17.0002 2.76347 16.7473 2.15301 16.2972 1.70291C15.8471 1.25281 15.2367 0.999951 14.6001 0.999951Z"
              />
          <path
              d="M9.199 1.19892C9.3584 1.03951 9.57461 0.949951 9.80005 0.949951H14.6001C15.2499 0.949951 15.8731 1.20808 16.3326 1.66755C16.7921 2.12703 17.0502 2.75021 17.0502 3.4V14.6002C17.0502 15.25 16.7921 15.8732 16.3326 16.3327C15.8731 16.7921 15.2499 17.0503 14.6001 17.0503H9.80005C9.57461 17.0503 9.3584 16.9607 9.199 16.8013C9.03959 16.6419 8.95003 16.4257 8.95003 16.2003C8.95003 15.9748 9.03959 15.7586 9.199 15.5992C9.3584 15.4398 9.57461 15.3502 9.80005 15.3502H14.6001C14.7991 15.3502 14.9898 15.2712 15.1305 15.1306C15.2711 14.9899 15.3502 14.7991 15.3502 14.6002V3.4C15.3502 3.20108 15.2711 3.01031 15.1305 2.86966C14.9898 2.729 14.7991 2.64998 14.6001 2.64998H9.80005C9.57461 2.64998 9.3584 2.56043 9.199 2.40102C9.03959 2.24161 8.95003 2.02541 8.95003 1.79997C8.95003 1.57453 9.03959 1.35832 9.199 1.19892ZM9.80005 1.04995C9.60113 1.04995 9.41036 1.12897 9.26971 1.26963C9.12905 1.41028 9.05003 1.60105 9.05003 1.79997C9.05003 1.99888 9.12905 2.18965 9.26971 2.33031C9.41036 2.47096 9.60113 2.54998 9.80005 2.54998H14.6001C14.8256 2.54998 15.0418 2.63954 15.2012 2.79895C15.3606 2.95836 15.4502 3.17456 15.4502 3.4V14.6002C15.4502 14.8257 15.3606 15.0419 15.2012 15.2013C15.0418 15.3607 14.8256 15.4502 14.6001 15.4502H9.80005C9.60113 15.4502 9.41036 15.5293 9.26971 15.6699C9.12905 15.8106 9.05003 16.0013 9.05003 16.2003C9.05003 16.3992 9.12905 16.5899 9.26971 16.7306C9.41036 16.8713 9.60113 16.9503 9.80005 16.9503H14.6001C15.2234 16.9503 15.8212 16.7027 16.2619 16.262C16.7026 15.8212 16.9502 15.2235 16.9502 14.6002V3.4C16.9502 2.77673 16.7026 2.17898 16.2619 1.73826C15.8212 1.29754 15.2234 1.04995 14.6001 1.04995H9.80005Z"
              />
          <path
              d="M5.56572 11.6346C5.64213 11.7083 5.70307 11.7966 5.745 11.8942C5.78693 11.9918 5.809 12.0968 5.80992 12.203C5.81085 12.3093 5.7906 12.4146 5.75038 12.5129C5.71015 12.6112 5.65075 12.7006 5.57563 12.7757C5.50052 12.8508 5.41119 12.9102 5.31288 12.9504C5.21456 12.9907 5.10921 13.0109 5.00298 13.01C4.89676 13.0091 4.79178 12.987 4.69418 12.9451C4.59657 12.9031 4.50829 12.8422 4.43449 12.7658L1.23443 9.56571C1.08445 9.41568 1.0002 9.21223 1.0002 9.0001C1.0002 8.78796 1.08445 8.58451 1.23443 8.43449L4.43449 5.23442C4.50829 5.15801 4.59657 5.09706 4.69418 5.05514C4.79178 5.01321 4.89676 4.99114 5.00298 4.99022C5.10921 4.98929 5.21456 5.00953 5.31288 5.04976C5.41119 5.08999 5.50052 5.14939 5.57563 5.2245C5.65075 5.29962 5.71015 5.38894 5.75038 5.48726C5.7906 5.58558 5.81085 5.69093 5.80992 5.79715C5.809 5.90338 5.78693 6.00836 5.745 6.10596C5.70307 6.20357 5.64213 6.29184 5.56572 6.36564L3.73128 8.20008H13.0003C13.2124 8.20008 13.4159 8.28437 13.566 8.4344C13.716 8.58443 13.8003 8.78792 13.8003 9.0001C13.8003 9.21227 13.716 9.41576 13.566 9.56579C13.4159 9.71583 13.2124 9.80011 13.0003 9.80011H3.73128L5.56572 11.6346Z"
              />
          <path
              d="M5.29394 5.09604C5.20177 5.05832 5.10301 5.03935 5.00342 5.04021C4.90383 5.04108 4.80542 5.06177 4.71391 5.10108C4.62241 5.14038 4.53965 5.19752 4.47046 5.26916L1.26979 8.46984C1.12918 8.61048 1.0502 8.80122 1.0502 9.0001C1.0502 9.19897 1.12918 9.38971 1.26979 9.53036L4.46985 12.7304C4.53904 12.8021 4.62241 12.8598 4.71391 12.8991C4.80542 12.9384 4.90383 12.9591 5.00342 12.96C5.10301 12.9608 5.20177 12.9419 5.29394 12.9042C5.38612 12.8664 5.46986 12.8108 5.54028 12.7403C5.6107 12.6699 5.66639 12.5862 5.7041 12.494C5.74181 12.4018 5.76079 12.3031 5.75992 12.2035C5.75906 12.1039 5.73837 12.0055 5.69906 11.914C5.65975 11.8225 5.60262 11.7397 5.53098 11.6705L3.61057 9.75011H13.0003C13.1992 9.75011 13.39 9.67109 13.5306 9.53044C13.6713 9.38978 13.7503 9.19901 13.7503 9.0001C13.7503 8.80118 13.6713 8.61041 13.5306 8.46976C13.39 8.3291 13.1992 8.25008 13.0003 8.25008H3.61057L5.53036 6.33029C5.602 6.2611 5.65975 6.17773 5.69906 6.08623C5.73837 5.99472 5.75906 5.89631 5.75992 5.79672C5.76079 5.69713 5.74181 5.59837 5.7041 5.5062C5.66639 5.41402 5.6107 5.33028 5.54028 5.25986C5.46986 5.18944 5.38612 5.13375 5.29394 5.09604ZM5.00255 4.94022C5.11541 4.93924 5.22734 4.96074 5.33181 5.00348C5.43627 5.04622 5.53118 5.10934 5.61099 5.18915C5.6908 5.26896 5.75392 5.36387 5.79666 5.46833C5.83939 5.57279 5.8609 5.68472 5.85992 5.79759C5.85894 5.91045 5.83549 6.02199 5.79094 6.1257C5.74645 6.22926 5.68181 6.32295 5.60077 6.4013L3.85199 8.15008H13.0003C13.2257 8.15008 13.4419 8.23964 13.6013 8.39904C13.7607 8.55845 13.8503 8.77466 13.8503 9.0001C13.8503 9.22554 13.7607 9.44174 13.6013 9.60115C13.4419 9.76056 13.2257 9.85011 13.0003 9.85011H3.85199L5.60076 11.5989C5.6818 11.6772 5.74645 11.7709 5.79094 11.8745C5.83549 11.9782 5.85894 12.0897 5.85992 12.2026C5.8609 12.3155 5.83939 12.4274 5.79666 12.5319C5.75392 12.6363 5.6908 12.7312 5.61099 12.811C5.53118 12.8909 5.43627 12.954 5.33181 12.9967C5.22734 13.0395 5.11541 13.061 5.00255 13.06C4.88969 13.059 4.77815 13.0355 4.67444 12.991C4.57087 12.9465 4.47719 12.8819 4.39884 12.8008L1.19907 9.60106C1.03972 9.44166 0.950195 9.22549 0.950195 9.0001C0.950195 8.7747 1.03972 8.55854 1.19907 8.39914L4.39883 5.19937C4.47718 5.11833 4.57087 5.05369 4.67444 5.0092C4.77815 4.96465 4.88969 4.9412 5.00255 4.94022Z"
              />
        </svg>
        <div class="text">Выйти</div>
      </div>
    </div>
  </div>
</template>

<style lang="scss" scoped>
.profile {
  position: relative;
  display: flex;
  align-items: center;
  cursor: pointer;

  .name {
    margin-right: 10px;
    font-size: 16px;
    font-weight: 700;
    line-height: 19.2px;
    color: #FFFFFF;

    @media screen and (max-width: 770px) {
      font-size: 14px;
      line-height: 16.8px;
    }
  }

  .img {
    position: relative;
    margin-right: 10px;
    display: flex;
    width: 32px;
    height: 32px;
    margin-right: 12px;
    border-radius: 50%;
    background-color: #FFFFFF;

    &:after {
      content: '';
      display: block;
      margin: auto;
      width: 13px;
      height: 16px;
      background-image: url("../../img/user.svg");
      background-repeat: no-repeat;
      background-size: contain;
      background-position: center center;
    }

    @media screen and (max-width: 770px) {
      width: 28px;
      height: 28px;
    }
  }

  .arrow {
    width: 12px;
    height: 12px;
    background-image: url("../../img/arrow.svg");
    background-repeat: no-repeat;
    background-size: contain;
    background-position: center center;

    &.open {
      transform: scale(1, -1);
    }
  }

  .content {
    position: absolute;
    width: max-content;
    right: 0;
    top: 140%;
    background-color: #FFFFFF;
    border: 1px solid #E6E6E6;
    border-radius: 10px;
    color: #686B74;
    padding: 16px 14px;
    box-sizing: border-box;
    visibility: hidden;
    opacity: 0;
    transition: opacity .2s ease-in-out, visibility .2s ease-in-out;

    &.open {
      visibility: visible;
      opacity: 1;
    }

    .item {
      cursor: pointer;
      display: flex;
      align-items: center;
      margin-bottom: 16px;

      &:last-of-type {
        margin-bottom: 0;
      }

      .icon {
        margin-right: 12px;
        height: 20px;
        width: 20px;
        background-position: center center;
        background-repeat: no-repeat;
        background-size: contain;


        &.profile {
          fill: #B9BBC1;
        }

        &.wallet {
          stroke: #B9BBC1;
        }

        &.help {
          stroke: #B9BBC1;
        }

        &.exit {
          fill: #B9BBC1;
        }
      }

      .text {
        font-size: 14px;
        font-weight: 600;
        line-height: 19.6px;
      }

      &:hover {

        .text {
          color: #8F47FF;
        }

        .icon {
          &.profile {
            fill: #8F47FF;
          }

          &.wallet {
            stroke: #8F47FF;
          }

          &.help {
            stroke: #8F47FF;
          }

          &.exit {
            fill: #8F47FF;
          }
        }

      }
    }


  }
}
</style>